<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI English Call (Pro)</title>
    <link rel="manifest" href="manifest.json">
    <style>
        /* --- ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆå¤‰æ›´ãªã—ï¼‰ --- */
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            overflow: hidden;
        }
        .caller-area { margin-top: 50px; text-align: center; }
        .avatar {
            width: 120px; height: 120px; background-color: rgba(255,255,255,0.2);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 50px; margin: 0 auto 15px; border: 2px solid rgba(255,255,255,0.5);
            box-shadow: 0 0 20px rgba(0,0,0,0.3); transition: all 0.3s;
        }
        .status { font-size: 14px; opacity: 0.8; margin-top: 5px; }
        .settings-area { background: rgba(0,0,0,0.3); padding: 10px 20px; border-radius: 20px; backdrop-filter: blur(5px); margin-bottom: 10px; }
        select { background: transparent; color: white; border: 1px solid rgba(255,255,255,0.5); padding: 5px; border-radius: 5px; font-size: 16px; }
        .subtitle-area { flex-grow: 1; width: 90%; display: flex; flex-direction: column; justify-content: center; text-align: center; gap: 15px; }
        .sub-en { font-size: 22px; font-weight: bold; text-shadow: 0 2px 4px rgba(0,0,0,0.5); line-height: 1.3; }
        .sub-jp { font-size: 15px; opacity: 0.8; color: #ddd; }
        .controls { margin-bottom: 40px; display: flex; gap: 20px; }
        .btn-call { width: 70px; height: 70px; border-radius: 50%; border: none; color: white; font-size: 30px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: transform 0.1s; }
        .btn-start { background-color: #4CAF50; }
        .btn-stop { background-color: #f44336; display: none; }
        .btn-call:active { transform: scale(0.95); }
        @keyframes gradient { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .listening-pulse { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); animation: pulse 1.5s infinite; }
        .speaking-pulse { box-shadow: 0 0 0 0 rgba(255, 235, 59, 0.7); animation: pulse-yellow 1.5s infinite; transform: scale(1.1); }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(76, 175, 80, 0); } 100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); } }
        @keyframes pulse-yellow { 0% { box-shadow: 0 0 0 0 rgba(255, 235, 59, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(255, 235, 59, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 235, 59, 0); } }
    </style>
</head>
<body>

    <div class="caller-area">
        <div class="avatar" id="avatar">â˜•</div>
        <h2 id="role-name">Cafe Staff</h2>
        <div class="status" id="status-text">Tap green button</div>
    </div>

    <div class="settings-area">
        <label>Scenario: </label>
        <select id="scenario-select" onchange="changeScenario()">
            <option value="cafe">â˜• ã‚«ãƒ•ã‚§ (æ³¨æ–‡)</option>
            <option value="tutor">ğŸ‘©â€ğŸ« å…ˆç”Ÿ (è‡ªå·±ç´¹ä»‹)</option>
            <option value="hotel">ğŸ¨ ãƒ›ãƒ†ãƒ« (å—ä»˜)</option>
            <option value="street">ğŸ—ºï¸ é“æ¡ˆå†… (å°‹ã­ã‚‹)</option>
            <option value="doctor">ğŸ¥ ç—…é™¢ (ç—‡çŠ¶)</option>
        </select>
    </div>

    <div class="subtitle-area">
        <div class="sub-en" id="text-en">Welcome!</div>
        <div class="sub-jp" id="text-jp">ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›ï¼</div>
    </div>

    <div class="controls">
        <button class="btn-call btn-start" id="btn-start" onclick="startConversation()">ğŸ“</button>
        <button class="btn-call btn-stop" id="btn-stop" onclick="stopConversation()">âŒ</button>
    </div>

    <script>
        // --- â˜…ã“ã“ãŒæ‹¡å¼µã•ã‚ŒãŸä¼šè©±ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã™â˜… ---
        const scenarios = {
            cafe: {
                name: "Barista", icon: "â˜•", 
                greeting: { en: "Hi! What can I get for you today?", jp: "ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›ã€ã”æ³¨æ–‡ã¯ä½•ã«ã—ã¾ã™ã‹ï¼Ÿ" },
                responses: [
                    { keywords: ["coffee", "latte", "espresso", "cappuccino"], en: "Hot or Iced?", jp: "ãƒ›ãƒƒãƒˆã«ã—ã¾ã™ã‹ï¼Ÿã‚¢ã‚¤ã‚¹ã«ã—ã¾ã™ã‹ï¼Ÿ" },
                    { keywords: ["hot", "warm"], en: "Got it. Size? Tall or Grande?", jp: "äº†è§£ã§ã™ã€‚ã‚µã‚¤ã‚ºã¯ï¼Ÿãƒˆãƒ¼ãƒ«ï¼Ÿã‚°ãƒ©ãƒ³ãƒ‡ï¼Ÿ" },
                    { keywords: ["ice", "cold"], en: "Iced one. Size? Tall or Grande?", jp: "ã‚¢ã‚¤ã‚¹ã§ã™ã­ã€‚ã‚µã‚¤ã‚ºã¯ï¼Ÿãƒˆãƒ¼ãƒ«ï¼Ÿã‚°ãƒ©ãƒ³ãƒ‡ï¼Ÿ" },
                    { keywords: ["tall", "grande", "small", "large"], en: "Okay, anything else to eat?", jp: "ã‹ã—ã“ã¾ã‚Šã¾ã—ãŸã€‚ä»–ã«ãŠé£Ÿäº‹ã¯ï¼Ÿ" },
                    { keywords: ["no", "that's all", "nothing"], en: "Okay, your total is $5.", jp: "ãŠä¼šè¨ˆã¯5ãƒ‰ãƒ«ã«ãªã‚Šã¾ã™ã€‚" }
                ],
                fallback: { en: "Sorry, do you want Coffee or Tea?", jp: "ã™ã¿ã¾ã›ã‚“ã€ã‚³ãƒ¼ãƒ’ãƒ¼ã«ã—ã¾ã™ã‹ï¼Ÿç´…èŒ¶ã«ã—ã¾ã™ã‹ï¼Ÿ" }
            },
            tutor: {
                name: "Emma (Teacher)", icon: "ğŸ‘©â€ğŸ«", 
                greeting: { en: "Hello! My name is Emma. What is your name?", jp: "ã“ã‚“ã«ã¡ã¯ï¼ã‚¨ãƒã§ã™ã€‚ã‚ãªãŸã®ãŠåå‰ã¯ï¼Ÿ" },
                responses: [
                    { keywords: ["my name", "i am", "call me"], en: "Nice to meet you! Where are you from?", jp: "ã¯ã˜ã‚ã¾ã—ã¦ï¼å‡ºèº«ã¯ã©ã“ã§ã™ã‹ï¼Ÿ" },
                    { keywords: ["japan", "tokyo", "osaka"], en: "Oh, I love Japan! Do you like English?", jp: "æ—¥æœ¬å¤§å¥½ãã§ã™ï¼è‹±èªã¯å¥½ãã§ã™ã‹ï¼Ÿ" },
                    { keywords: ["yes", "like", "love"], en: "That is great! Let's study together.", jp: "ãã‚Œã¯è‰¯ã‹ã£ãŸï¼ä¸€ç·’ã«å‹‰å¼·ã—ã¾ã—ã‚‡ã†ã€‚" },
                    { keywords: ["no", "difficult", "hard"], en: "Don't worry. Step by step.", jp: "å¿ƒé…ã—ãªã„ã§ã€‚å°‘ã—ãšã¤ã‚„ã‚Šã¾ã—ã‚‡ã†ã€‚" }
                ],
                fallback: { en: "I see. Please tell me more.", jp: "ãªã‚‹ã»ã©ã€‚ã‚‚ã£ã¨æ•™ãˆã¦ãã ã•ã„ã€‚" }
            },
            hotel: {
                name: "Front Desk", icon: "ğŸ¨", 
                greeting: { en: "Good afternoon. Checking in?", jp: "ã“ã‚“ã«ã¡ã¯ã€‚ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã§ã™ã‹ï¼Ÿ" },
                responses: [
                    { keywords: ["check in", "yes", "reservation"], en: "May I have your name and passport?", jp: "ãŠåå‰ã¨ãƒ‘ã‚¹ãƒãƒ¼ãƒˆã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚" },
                    { keywords: ["here", "name is", "passport"], en: "Thank you. You are in room 305.", jp: "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚ãŠéƒ¨å±‹ã¯305å·å®¤ã§ã™ã€‚" },
                    { keywords: ["breakfast", "food"], en: "Breakfast is served from 7 to 10 am.", jp: "æœé£Ÿã¯7æ™‚ã‹ã‚‰10æ™‚ã¾ã§ã§ã™ã€‚" },
                    { keywords: ["wifi", "internet"], en: "The password is 'hotel123'.", jp: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ hotel123 ã§ã™ã€‚" }
                ],
                fallback: { en: "Could you say that again?", jp: "ã‚‚ã†ä¸€åº¦ãŠé¡˜ã„ã—ã¾ã™ã€‚" }
            },
            street: {
                name: "Pedestrian", icon: "ğŸš¶", 
                greeting: { en: "Excuse me, do you need help?", jp: "ã™ã¿ã¾ã›ã‚“ã€ãŠå›°ã‚Šã§ã™ã‹ï¼Ÿ" },
                responses: [
                    { keywords: ["station", "train", "subway"], en: "Go straight and turn right.", jp: "ã¾ã£ã™ãè¡Œã£ã¦ã€å³ã«æ›²ãŒã£ã¦ãã ã•ã„ã€‚" },
                    { keywords: ["restaurant", "food", "eat"], en: "There is a good pizza place over there.", jp: "ã‚ãã“ã«ç¾å‘³ã—ã„ãƒ”ã‚¶å±‹ãŒã‚ã‚Šã¾ã™ã‚ˆã€‚" },
                    { keywords: ["thank"], en: "No problem. Have a nice trip!", jp: "ã©ã†ã„ãŸã—ã¾ã—ã¦ã€‚è‰¯ã„æ—…ã‚’ï¼" }
                ],
                fallback: { en: "I'm not sure, sorry.", jp: "ã”ã‚ã‚“ãªã•ã„ã€ã¡ã‚‡ã£ã¨ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚" }
            },
            doctor: {
                name: "Dr. Smith", icon: "ğŸ¥", 
                greeting: { en: "Hi, what is the problem today?", jp: "ã“ã‚“ã«ã¡ã¯ã€ä»Šæ—¥ã¯ã©ã†ã•ã‚Œã¾ã—ãŸã‹ï¼Ÿ" },
                responses: [
                    { keywords: ["headache", "head", "pain"], en: "I see. How long have you had it?", jp: "ãªã‚‹ã»ã©ã€‚ã„ã¤ã‹ã‚‰ç—›ã¿ã¾ã™ã‹ï¼Ÿ" },
                    { keywords: ["stomach", "tummy"], en: "Did you eat something strange?", jp: "ä½•ã‹å¤‰ãªã‚‚ã®ã‚’é£Ÿã¹ã¾ã—ãŸã‹ï¼Ÿ" },
                    { keywords: ["fever", "hot"], en: "Let me check your temperature.", jp: "ç†±ã‚’æ¸¬ã‚‰ã›ã¦ãã ã•ã„ã€‚" },
                    { keywords: ["medicine", "drug"], en: "Take this pill after dinner.", jp: "å¤•é£Ÿå¾Œã«ã“ã®è–¬ã‚’é£²ã‚“ã§ãã ã•ã„ã€‚" }
                ],
                fallback: { en: "Does it hurt?", jp: "ç—›ã¿ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ" }
            }
        };

        // --- ã‚·ã‚¹ãƒ†ãƒ å¤‰æ•°ã¨é–¢æ•°ï¼ˆå‰å›ã‹ã‚‰å¤‰æ›´ãªã—ï¼‰ ---
        let recognition;
        let isRecording = false;
        let isSpeaking = false;
        let currentScenario = 'cafe';

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.lang = 'en-US';
            recognition.interimResults = false;

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.toLowerCase();
                document.getElementById('text-en').innerText = "You: " + transcript;
                document.getElementById('text-jp').innerText = "...";
                setTimeout(() => processAIResponse(transcript), 800);
            };
            recognition.onend = () => {
                if (isRecording && !isSpeaking) recognition.start();
            };
        }

        function changeScenario() {
            currentScenario = document.getElementById('scenario-select').value;
            const data = scenarios[currentScenario];
            document.getElementById('avatar').innerText = data.icon;
            document.getElementById('role-name').innerText = data.name;
            document.getElementById('text-en').innerText = data.greeting.en;
            document.getElementById('text-jp').innerText = data.greeting.jp;
        }

        function startConversation() {
            isRecording = true;
            document.getElementById('btn-start').style.display = 'none';
            document.getElementById('btn-stop').style.display = 'flex';
            document.getElementById('status-text').innerText = "Listening...";
            document.getElementById('avatar').className = 'avatar listening-pulse';
            const u = new SpeechSynthesisUtterance('');
            speechSynthesis.speak(u);
            if(recognition) recognition.start();
        }

        function stopConversation() {
            isRecording = false;
            document.getElementById('btn-start').style.display = 'flex';
            document.getElementById('btn-stop').style.display = 'none';
            document.getElementById('status-text').innerText = "Call ended";
            document.getElementById('avatar').className = 'avatar';
            if(recognition) recognition.stop();
            speechSynthesis.cancel();
        }

        function processAIResponse(userText) {
            isSpeaking = true;
            if(recognition) recognition.stop();

            const data = scenarios[currentScenario];
            let replyEn = data.fallback.en;
            let replyJp = data.fallback.jp;

            // éƒ¨åˆ†ä¸€è‡´ã§ã‚‚åå¿œã™ã‚‹ã‚ˆã†ã«æ”¹è‰¯ï¼ˆincludesåˆ¤å®šï¼‰
            for (const resp of data.responses) {
                if (resp.keywords.some(keyword => userText.includes(keyword))) {
                    replyEn = resp.en;
                    replyJp = resp.jp;
                    break;
                }
            }

            document.getElementById('text-en').innerText = replyEn;
            document.getElementById('text-jp').innerText = replyJp;
            document.getElementById('avatar').className = 'avatar speaking-pulse';
            document.getElementById('status-text').innerText = "Speaking...";

            const ut = new SpeechSynthesisUtterance(replyEn);
            ut.lang = 'en-US';
            ut.rate = 1.0;
            ut.onend = () => {
                isSpeaking = false;
                document.getElementById('avatar').className = 'avatar listening-pulse';
                document.getElementById('status-text').innerText = "Listening...";
                if (isRecording) recognition.start();
            };
            speechSynthesis.speak(ut);
        }
    </script>
</body>
</html>
